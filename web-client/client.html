<!DOCTYPE html>
<html lang="es">

<head>
  <meta charset="UTF-8" />
  <title>StreamDeck Controller</title>
  <style>
    body {
      font-family: sans-serif;
      background: #111;
      color: #eee;
      text-align: center;
      margin: 0;
      padding: 1em;
    }

    button {
      display: inline-block;
      margin: 0.5em;
      padding: 1em 2em;
      font-size: 16px;
      border-radius: 8px;
      border: none;
      cursor: pointer;
      background: #444;
      color: white;
    }

    button:hover {
      background: #666;
    }

    #now-playing {
      margin-top: 2em;
      padding: 1em;
      border: 1px solid #333;
      border-radius: 10px;
      background: #222;
      display: inline-block;
      text-align: center;
    }

    #now-playing img {
      max-width: 150px;
      border-radius: 10px;
      margin-bottom: 1em;
    }
  </style>
</head>

<body>
  <h1>StreamDeck Controller</h1>

  <div>
    <button onclick="sendAction('spotify','toggle_play')">‚ñ∂Ô∏è / ‚è∏</button>
    <button onclick="sendAction('spotify','prev')">‚èÆ</button>
    <button onclick="sendAction('spotify','next')">‚è≠</button>
  </div>

  <div>
    <button onclick="sendAction('system','volume_up')">üîä Vol +</button>
    <button onclick="sendAction('system','volume_down')">üîâ Vol -</button>
    <button onclick="sendAction('system','mute_toggle')">üîá Mute</button>
  </div>

  <div id="now-playing">
    <h2>Now Playing</h2>
    <img id="np-image" src="" alt="Album cover" style="display:none;" />
    <p id="np-title">T√≠tulo: -</p>
    <p id="np-artist">Artista: -</p>
    <p id="np-album">√Ålbum: -</p>
    <p id="np-time">00:00 / 00:00</p>
  </div>

  <script>
    const ws = new WebSocket("ws://" + location.hostname + ":8765/?token=1234");

    ws.onopen = () => {
      console.log("Conectado al servidor WS");
    };

    function formatTime(sec) {
      if (!sec || sec < 0) return "00:00";
      const m = Math.floor(sec / 60);
      const s = sec % 60;
      return String(m).padStart(2, "0") + ":" + String(s).padStart(2, "0");
    }

    ws.onmessage = (event) => {
      const data = JSON.parse(event.data);
      console.log("WS message:", data);

      if (data.type === "now_playing") {
        document.getElementById("np-title").textContent = "T√≠tulo: " + (data.title || "-");
        document.getElementById("np-artist").textContent = "Artista: " + (data.artist || "-");
        document.getElementById("np-album").textContent = "√Ålbum: " + (data.album || "-");
        document.getElementById("np-time").textContent = formatTime(data.progress) + " / " + formatTime(data.duration);

        if (data.image) {
          const img = document.getElementById("np-image");
          img.src = data.image;
          img.style.display = "block";
        } else {
          document.getElementById("np-image").style.display = "none";
        }
      }

    };

    ws.onclose = () => {
      console.log("Conexi√≥n WS cerrada");
    };

    function sendAction(type, cmd) {
      const action = { type, cmd };
      ws.send(JSON.stringify({ type: "exec", action }));
    }

  </script>
</body>

</html>